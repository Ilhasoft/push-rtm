{% extends "base.html" %}
{% load i18n static sass_tags ureport %}

{% block nav_item %}page-dashboard{% endblock %}

{% block css_extra %}
  <link rel="stylesheet" href="{% sass_src 'css/dashboard/dashboard.scss' %}">
  <link rel="stylesheet" href="{% sass_src 'plugins/tooltip/tooltip.scss' %}">
{% endblock %}

{% block content %}
  <section class="section">
    <h1 class="title">{{ request.org }}</h1>
  </section>

  <section class="section">
    <div class="box is-shadowless">
      <div class="left-p-20">
        <span class="has-text-weight-bold">SDGs being tracked</span>
        <span class="tooltip top left-m-10">
          <i class="material-icons info-icon">info</i>
          <span class="tooltip-content">{% trans 'Number of total messages received addressing each SDG'%}</span>
        </span>
      </div>
      <canvas id="bubbleChart"></canvas>
    </div>
    <div class="box is-shadowless is-paddingless">
      <div class="columns is-marginless">
        <div class="column is-three-fifths border-right p-30">
          <span class="has-text-weight-bold">Surveys Partial Results</span>
          <span class="tooltip top left-m-10">
            <i class="material-icons info-icon">info</i>
            <span class="tooltip-content">{% trans 'Partial SDG results for the lastest ongoing surveys'%}</span>
          </span>
          <div class="selected-question top-m-30">
            <div class="selected-question__title bottom-m-30">
              How often have you had problems accessing clean drinking water at home? Rarely, sometimes, often or always?
            </div>
            <div class="selected-question__chart">
              <canvas id="questionChart"></canvas>
            </div>
          </div>
        </div>
        <div class="column is-paddingless">
          <div class="questions-header has-text-weight-bold p-30">
            <div>34 Questions</div>
            <div class="dropdown is-hoverable">
              <div class="dropdown-trigger">
                <div aria-haspopup="true" aria-controls="dropdown-menu">
                  <span>SDG 1</span>
                  <span class="icon is-small">
                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                  </span>
                </div>
              </div>
              <div class="dropdown-menu" id="dropdown-menu" role="menu">
                <div class="dropdown-content">
                  <a href="#" class="dropdown-item">SDG1</a>
                  <a href="#" class="dropdown-item">SDG2</a>
                  <a href="#" class="dropdown-item">SDG3</a>
                  <a href="#" class="dropdown-item">SDG4</a>
                  <a href="#" class="dropdown-item">SDG5</a>
                  <a href="#" class="dropdown-item">SDG6</a>
                </div>
              </div>
            </div>
          </div>
          <div class="questions-list">
            <div class="questions-list__item p-30 border-bottom">
              How often have you had problems accessing clean drinking water at home? Rarely, sometimes, often or always?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              Who collects and disposes  your household waste? The city, your landlord, a group of people, you or other person?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              Is there a service available for someone to collect plastic bottles separately from the general waste, either for free or for a payment?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              How often have you had problems accessing clean drinking water at home? Rarely, sometimes, often or always?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              Who collects and disposes  your household waste? The city, your landlord, a group of people, you or other person?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              Is there a service available for someone to collect plastic bottles separately from the general waste, either for free or for a payment?
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block js_extra %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>

{% for key, value in bublle_data.items %}
  {{ value|json_script:key }}
{% endfor %}

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <script>
    let bubbleCtx = document.getElementById('bubbleChart').getContext('2d');
    let bubbleChart = new Chart(bubbleCtx, {
      type: 'bubble',
      options: {
        responsive: true,
        legend: {
          labels: {
            fontSize: 14,
            padding: 18,
            usePointStyle: true,
          },
          position: 'left',
        },
        plugins: {
          datalabels: {
            display: false,
          }
        },
      },
      data: {
        datasets: [
          {
            label: '1 NO POVERTY',
            data: [JSON.parse(document.getElementById('bubble-sdg-1').textContent)],
            backgroundColor:"#e3263b",
            borderColor: '#FFFFFF',
          },
          {
            label: '2 ZERO HUNGER',
            data: [JSON.parse(document.getElementById('bubble-sdg-2').textContent)],
            backgroundColor:"#dfa739",
            borderColor: '#FFFFFF',
          },
          {
            label: '3 GOOD HEALTH AND WELL-BEING',
            data: [JSON.parse(document.getElementById('bubble-sdg-3').textContent)],
            backgroundColor:"#4d9f45",
            borderColor: '#FFFFFF',
          },
          {
            label: '4 QUALITY EDUCATION',
            data: [JSON.parse(document.getElementById('bubble-sdg-4').textContent)],
            backgroundColor:"#c5202e",
            borderColor: '#FFFFFF',
          },
          {
            label: '5 GENDER EQUALITY',
            data: [JSON.parse(document.getElementById('bubble-sdg-5').textContent)],
            backgroundColor:"#ef402c",
            borderColor: '#FFFFFF',
          },
          {
            label: '6 CLEAN WATER AND SANITATION',
            data: [JSON.parse(document.getElementById('bubble-sdg-6').textContent)],
            backgroundColor:"#29bee2",
            borderColor: '#FFFFFF',
          },
          {
            label: '7 AFFORDABLE AND CLEAN ENERGY',
            data: [JSON.parse(document.getElementById('bubble-sdg-7').textContent)],
            backgroundColor:"#f9c316",
            borderColor: '#FFFFFF',
          },
          {
            label: '8 DECENT WORK AND ECONOMIC GROWTH',
            data: [JSON.parse(document.getElementById('bubble-sdg-8').textContent)],
            backgroundColor:"#a21b45",
            borderColor: '#FFFFFF',
          },
          {
            label: '9 INDUSTRY, INNOVATION AND INFRASTRUCTURE',
            data: [JSON.parse(document.getElementById('bubble-sdg-9').textContent)],
            backgroundColor:"#f3692c",
            borderColor: '#FFFFFF',
          },
          {
            label: '10 REDUCED INEQUALITY',
            data: [JSON.parse(document.getElementById('bubble-sdg-10').textContent)],
            backgroundColor:"#dd2467",
            borderColor: '#FFFFFF',
          },
          {
            label: '11 SUSTAINABLE CITIES AND COMMUNITIES',
            data: [JSON.parse(document.getElementById('bubble-sdg-11').textContent)],
            backgroundColor:"#f99d28",
            borderColor: '#FFFFFF',
          },
          {
            label: '12 RESPONSIBLE COMSUMPTION AND PRODUCTION',
            data: [JSON.parse(document.getElementById('bubble-sdg-12').textContent)],
            backgroundColor:"#be8b2d",
            borderColor: '#FFFFFF',
          },
          {
            label: '13 CLIMATE ACTION',
            data: [JSON.parse(document.getElementById('bubble-sdg-13').textContent)],
            backgroundColor:"#407f45",
            borderColor: '#FFFFFF',
          },
          {
            label: '14 LIFE BELOW WATER',
            data: [JSON.parse(document.getElementById('bubble-sdg-14').textContent)],
            backgroundColor:"#1c97d3",
            borderColor: '#FFFFFF',
          },
          {
            label: '15 LIFE ON LAND',
            data: [JSON.parse(document.getElementById('bubble-sdg-15').textContent)],
            backgroundColor:"#5ebb47",
            borderColor: '#FFFFFF',
          },
          {
            label: '16 PEACE AND JUSTICE STRONG INSTITUTIONS',
            data: [JSON.parse(document.getElementById('bubble-sdg-16').textContent)],
            backgroundColor:"#056a9d",
            borderColor: '#FFFFFF',
          },
          {
            label: '17 PARTNERSHIPS TO ACHIEVE THE GOAL',
            data: [JSON.parse(document.getElementById('bubble-sdg-17').textContent)],
            backgroundColor:"#18486a",
            borderColor: '#FFFFFF',
          },
        ]
      }
    });

    let donutCtx = document.getElementById('questionChart').getContext('2d');
    let questionChart = new Chart(donutCtx, {
      type: 'doughnut',
        data: {
          labels: [
            'Never',
            'Always',
            'Sometimes',
            'Donâ€™t know',
          ],
          datasets: [{
            data: [12, 23, 50, 15],
            backgroundColor: [
                '#89e7ff',
                '#03aeef',
                '#0054e2',
                '#0400a4',
            ],
            borderColor: "rgba(255, 255, 255, 0.1)",
          }],
        },
        options: {
          legend: {
            labels: {
              fontSize: 14,
              padding: 18,
              usePointStyle: true,
            },
            position: 'left',
          },
          plugins: {
            datalabels: {
              formatter: (value, ctx) => {
                let sum = 0;
                let dataArr = ctx.chart.data.datasets[0].data;
                dataArr.map(data => {
                  sum += data;
                });
                let percentage = parseInt((value * 100 / sum));
                return percentage > 0 ? percentage + "%" : "";
              },
              color: '#fff',
            }
          }
        },
    });
  </script>

{% endblock %}
