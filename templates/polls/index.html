{% extends "base.html" %}
{% load i18n static ureport sass_tags %}

{% block nav_item %}page-surveys{% endblock %}

{% block css_extra %}
  <link rel="stylesheet" href="{% sass_src 'plugins/tooltip/tooltip.scss' %}">
{% endblock %}

{% block content %}
<section class="section">
  <h1 class="title">{{ request.org.name }}</h1>
  <h2 class="subtitle">{% trans "Surveys" %}</h2>
</section>

<section class="section">
    <div class="columns -is-mobile">
      <div class="column auto">
        <div class="control has-icons-left">
          <form>
            <input class="input is-medium search is-borderless" name="query" placeholder="Search" value="{{ query }}">
            <span class="icon is-left">
              <i class="material-icons">search</i>
            </span>
          </form>
        </div>
      </div>
      {% if not request.org.is_master %}
        <div class="column is-narrow">
          <div class="control">
            <a class="button is-medium is-info" href="{% url 'polls.poll_create' %}">
              <span class="icon">
                <i class="material-icons">share</i>
              </span>
              <span>{% trans "Connect Survey" %}</span>
            </a>
          </div>
        </div>
      {% endif %}
    </div>
    <table class="table is-fullwidth is-hoverable">
      <thead>
      <tr class="is-tr">
        <th></th>
        <th>{% autosort title _("Name") %}</th>
        <th class="has-text-centered">{% trans "Questions" %}</th>
        <th class="has-text-centered">{% trans "Last sync" %}</th>
        <th>{% trans "SDGs" %}</th>
        <th class="has-text-centered">{% autosort runs_count _("Runs") %}</th>
      </tr>
      </thead>
      <tbody class="has-header">
      
      {% for poll in polls %}
        <tr>
          <td><a href="{% url 'polls.poll_update' poll.id %}"><i class="material-icons">insert_drive_file</i></a></td>
          <td><a href="{% url 'results.poll_read' poll.id %}">{{ poll.title }}</a></td>
          <td class="has-text-centered"><a href="{% url 'polls.poll_questions' poll.id %}">{{ poll.get_questions.count }}</a></td>
          <td class="has-text-centered">{{ poll|get_poll_sync_status }}</td>
          <td>
            {% if poll.questions.count > 3 %}
              <span class="tooltip right">
                {% for sdg in poll.questions.distinct|slice:":3"|get_value_in_qs:'sdgs' %}
                  <span class="tag sdg-{{ sdg }}">SDG {{ sdg }}</span>
                {% endfor %}

                <span class="tooltip-content">
                  {% for sdg in poll.questions.distinct|get_value_in_qs:'sdgs' %}
                    <span class="tag sdg-{{ sdg }}">SDG {{ sdg }}</span>
                  {% endfor %}
                </span>
              </span>
            {% else %}
              {% for sdg in poll.questions.distinct|get_value_in_qs:'sdgs' %}
                <span class="tag sdg-{{ sdg }}">SDG {{ sdg }}</span>
              {% endfor %}
            {% endif%}
          </td>
          <td class="has-text-centered">{{ poll.runs_count }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="7" class="has-text-centered">{% trans "No results found" %}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <div class="is-pulled-right">
      {% include "paginator.html" with paginator=polls %}
    </div>
  </section>
{% endblock %}
