{% extends "base.html" %}
{% load i18n static sass_tags ureport %}

{% block nav_item %}page-dashboard{% endblock %}

{% block css_extra %}
  <link rel="stylesheet" href="{% sass_src 'css/dashboard/dashboard.scss' %}">
  <link rel="stylesheet" href="{% sass_src 'plugins/tooltip/tooltip.scss' %}">
{% endblock %}

{% block content %}
  <section class="section">
    <h1 class="title">{{ request.org }}</h1>
  </section>

  <section class="section">
    <div class="box is-shadowless">
      <div class="p-20 flex-space-between">
        <div>
          <span class="card-title has-text-weight-bold">SDGs being tracked</span>
          <span class="tooltip top left-m-10">
              <i class="material-icons info-icon">info</i>
              <span class="tooltip-content">{% trans 'Number of total messages received addressing each SDG'%}</span>
            </span>
        </div>
        <div class="dropdown is-hoverable">
          <div class="dropdown-trigger">
            <div aria-haspopup="true" aria-controls="dropdown-menu">
              <span>Last Year</span>
              <span class="icon is-small">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
            </div>
          </div>
          <div class="dropdown-menu" id="dropdown-menu" role="menu">
            <div class="dropdown-content">
              <a href="#" class="dropdown-item">Last Month</a>
              <a href="#" class="dropdown-item">Last Week</a>
              <a href="#" class="dropdown-item">Since Inception</a>
            </div>
          </div>
        </div>
      </div>
      <canvas id="bubbleChart"></canvas>
      <div class="card-title has-text-weight-bold p-20">SDGs not being tracked</div>
      <ul class="untracked-sgd">
        <li class="untracked-sgd__item">
          <div class="untracked-sgd__item__color sdg-11"></div>
          <div class="untracked-sgd__item__label">11 SUSTAINABLE CITIES AND COMMUNITIES</div>
        </li>
        <li class="untracked-sgd__item">
          <div class="untracked-sgd__item__color sdg-16"></div>
          <div class="untracked-sgd__item__label">16 PEACE, JUSTICE AND STRONG INSTITUTIONS</div>
        </li>
        <li class="untracked-sgd__item">
          <div class="untracked-sgd__item__color sdg-17"></div>
          <div class="untracked-sgd__item__label">17 PARTNERSHIPS FOR THE GOALS</div>
        </li>
      </ul>
    </div>
    <div class="box is-shadowless is-paddingless">
      <div class="columns is-marginless">
        <div class="column is-three-fifths border-right p-30">
          <span class="card-title has-text-weight-bold">Surveys Partial Results</span>
          <span class="tooltip top left-m-10">
            <i class="material-icons info-icon">info</i>
            <span class="tooltip-content">{% trans 'Partial SDG results for the lastest ongoing surveys'%}</span>
          </span>
          <div class="selected-question top-m-30">
            <div class="selected-question__title bottom-m-30">
              How often have you had problems accessing clean drinking water at home? Rarely, sometimes, often or always?
            </div>
            <div class="selected-question__chart">
              <canvas id="questionChart"></canvas>
            </div>
          </div>
        </div>
        <div class="column is-paddingless">
          <div class="flex-space-between has-text-weight-bold p-30">
            <div class="card-title">34 Questions</div>
            <div class="dropdown is-hoverable">
              <div class="dropdown-trigger">
                <div aria-haspopup="true" aria-controls="dropdown-menu">
                  <span>SDG 1</span>
                  <span class="icon is-small">
                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                  </span>
                </div>
              </div>
              <div class="dropdown-menu" id="dropdown-menu" role="menu">
                <div class="dropdown-content">
                  <a href="#" class="dropdown-item">SDG1</a>
                  <a href="#" class="dropdown-item">SDG2</a>
                  <a href="#" class="dropdown-item">SDG3</a>
                  <a href="#" class="dropdown-item">SDG4</a>
                  <a href="#" class="dropdown-item">SDG5</a>
                  <a href="#" class="dropdown-item">SDG6</a>
                </div>
              </div>
            </div>
          </div>
          <div class="questions-list">
            <div class="questions-list__item p-30 border-bottom">
              How often have you had problems accessing clean drinking water at home? Rarely, sometimes, often or always?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              Who collects and disposes  your household waste? The city, your landlord, a group of people, you or other person?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              Is there a service available for someone to collect plastic bottles separately from the general waste, either for free or for a payment?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              How often have you had problems accessing clean drinking water at home? Rarely, sometimes, often or always?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              Who collects and disposes  your household waste? The city, your landlord, a group of people, you or other person?
            </div>
            <div class="questions-list__item p-30 border-bottom">
              Is there a service available for someone to collect plastic bottles separately from the general waste, either for free or for a payment?
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="columns">
      <div class="column">
        <div class="box is-shadowless">
          <div class="p-20 flex-space-between">
            <div class="card-title has-text-weight-bold">Most used Channels</div>
            <div class="dropdown is-hoverable">
              <div class="dropdown-trigger">
                <div aria-haspopup="true" aria-controls="dropdown-menu">
                  <span>Last Year</span>
                  <span class="icon is-small">
                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                  </span>
                </div>
              </div>
              <div class="dropdown-menu" id="dropdown-menu" role="menu">
                <div class="dropdown-content">
                  <a href="#" class="dropdown-item">Last Month</a>
                  <a href="#" class="dropdown-item">Last Week</a>
                  <a href="#" class="dropdown-item">Since Inception</a>
                </div>
              </div>
            </div>
          </div>
          <div class="columns">
            <div class="column">
              <canvas id="localMostUsedChannels"></canvas>
            </div>
            <div class="column">
              <canvas id="globalMostUsedChannels"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="column is-one-fifth">
        <div class="surveys-card box is-shadowless">
          <div class="card-title left-p-10 top-p-10 bottom-p-20">
            <span class="has-text-weight-bold">Surveys</span>
            <span class="tooltip top left-m-10">
              <i class="material-icons info-icon">info</i>
              <span class="tooltip-content">{% trans 'Surveys being conducted through the RTM'%}</span>
            </span>
          </div>
          <div class="surveys-info has-text-centered bottom-p-30 border-bottom">
            <div class="surveys-info__number">175</div>
            <div class="surveys-info_unct">Brasil</div>
          </div>
          <div class="surveys-info has-text-centered top-p-30 bottom-p-30">
            <div class="surveys-info__number">--</div>
            <div class="surveys-info_unct">Global</div>
          </div>
        </div>
      </div>
    </div>
    <div class="box is-shadowless">
      <div class="card-title p-20 has-text-weight-bold">RapidPro Contacts</div>
      <div class="columns p-20">
        <div class="column is-three-fifths">
          <div class="has-text-weight-bold bottom-m-20">Contacts growth over time</div>
          <canvas id="contactsChart"></canvas>
        </div>
        <div class="column">
          <div class="has-text-weight-bold bottom-m-20">Portion of Global Total Contacts</div>
          <canvas id="pieChart"></canvas>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block js_extra %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>

{% for key, value in bublle_data.items %}
  {{ value|json_script:key }}
{% endfor %}

  <script>
    let bubbleCtx = document.getElementById('bubbleChart').getContext('2d');
    let bubbleChart = new Chart(bubbleCtx, {
      type: 'bubble',
      options: {
        responsive: true,
        legend: {
          labels: {
            fontSize: 14,
            padding: 18,
            usePointStyle: true,
          },
          position: 'left',
        },
        plugins: {
          datalabels: {
            display: false,
          }
        },
      },
      data: {
        datasets: [
          {
            label: '1 NO POVERTY',
            data: [JSON.parse(document.getElementById('bubble-sdg-1').textContent)],
            backgroundColor:"#e3263b",
            borderColor: '#FFFFFF',
          },
          {
            label: '2 ZERO HUNGER',
            data: [JSON.parse(document.getElementById('bubble-sdg-2').textContent)],
            backgroundColor:"#dfa739",
            borderColor: '#FFFFFF',
          },
          {
            label: '3 GOOD HEALTH AND WELL-BEING',
            data: [JSON.parse(document.getElementById('bubble-sdg-3').textContent)],
            backgroundColor:"#4d9f45",
            borderColor: '#FFFFFF',
          },
          {
            label: '4 QUALITY EDUCATION',
            data: [JSON.parse(document.getElementById('bubble-sdg-4').textContent)],
            backgroundColor:"#c5202e",
            borderColor: '#FFFFFF',
          },
          {
            label: '5 GENDER EQUALITY',
            data: [JSON.parse(document.getElementById('bubble-sdg-5').textContent)],
            backgroundColor:"#ef402c",
            borderColor: '#FFFFFF',
          },
          {
            label: '6 CLEAN WATER AND SANITATION',
            data: [JSON.parse(document.getElementById('bubble-sdg-6').textContent)],
            backgroundColor:"#29bee2",
            borderColor: '#FFFFFF',
          },
          {
            label: '7 AFFORDABLE AND CLEAN ENERGY',
            data: [JSON.parse(document.getElementById('bubble-sdg-7').textContent)],
            backgroundColor:"#f9c316",
            borderColor: '#FFFFFF',
          },
          {
            label: '8 DECENT WORK AND ECONOMIC GROWTH',
            data: [JSON.parse(document.getElementById('bubble-sdg-8').textContent)],
            backgroundColor:"#a21b45",
            borderColor: '#FFFFFF',
          },
          {
            label: '9 INDUSTRY, INNOVATION AND INFRASTRUCTURE',
            data: [JSON.parse(document.getElementById('bubble-sdg-9').textContent)],
            backgroundColor:"#f3692c",
            borderColor: '#FFFFFF',
          },
          {
            label: '10 REDUCED INEQUALITY',
            data: [JSON.parse(document.getElementById('bubble-sdg-10').textContent)],
            backgroundColor:"#dd2467",
            borderColor: '#FFFFFF',
          },
          {
            label: '11 SUSTAINABLE CITIES AND COMMUNITIES',
            data: [JSON.parse(document.getElementById('bubble-sdg-11').textContent)],
            backgroundColor:"#f99d28",
            borderColor: '#FFFFFF',
          },
          {
            label: '12 RESPONSIBLE COMSUMPTION AND PRODUCTION',
            data: [JSON.parse(document.getElementById('bubble-sdg-12').textContent)],
            backgroundColor:"#be8b2d",
            borderColor: '#FFFFFF',
          },
          {
            label: '13 CLIMATE ACTION',
            data: [JSON.parse(document.getElementById('bubble-sdg-13').textContent)],
            backgroundColor:"#407f45",
            borderColor: '#FFFFFF',
          },
          {
            label: '14 LIFE BELOW WATER',
            data: [JSON.parse(document.getElementById('bubble-sdg-14').textContent)],
            backgroundColor:"#1c97d3",
            borderColor: '#FFFFFF',
          },
          {
            label: '15 LIFE ON LAND',
            data: [JSON.parse(document.getElementById('bubble-sdg-15').textContent)],
            backgroundColor:"#5ebb47",
            borderColor: '#FFFFFF',
          },
          {
            label: '16 PEACE AND JUSTICE STRONG INSTITUTIONS',
            data: [JSON.parse(document.getElementById('bubble-sdg-16').textContent)],
            backgroundColor:"#056a9d",
            borderColor: '#FFFFFF',
          },
          {
            label: '17 PARTNERSHIPS TO ACHIEVE THE GOAL',
            data: [JSON.parse(document.getElementById('bubble-sdg-17').textContent)],
            backgroundColor:"#18486a",
            borderColor: '#FFFFFF',
          },
        ]
      }
    });

    let donutCtx = document.getElementById('questionChart').getContext('2d');
    let questionChart = new Chart(donutCtx, {
      type: 'doughnut',
        data: {
          labels: [
            'Never',
            'Always',
            'Sometimes',
            'Don’t know',
          ],
          datasets: [{
            data: [12, 23, 50, 15],
            backgroundColor: [
                '#89e7ff',
                '#03aeef',
                '#0054e2',
                '#0400a4',
            ],
            borderColor: "rgba(255, 255, 255, 0.1)",
          }],
        },
        options: {
          legend: {
            labels: {
              fontSize: 14,
              padding: 18,
              usePointStyle: true,
            },
            position: 'left',
          },
          plugins: {
            datalabels: {
              formatter: (value, ctx) => {
                let sum = 0;
                let dataArr = ctx.chart.data.datasets[0].data;
                dataArr.map(data => {
                  sum += data;
                });
                let percentage = parseInt((value * 100 / sum));
                return percentage > 0 ? percentage + "%" : "";
              },
              color: '#fff',
            }
          }
        },
    });

    let localMostUsedCtx = document.getElementById('localMostUsedChannels').getContext('2d');
    let localMostUsedChannels = new Chart(localMostUsedCtx, {
      type: 'doughnut',
      data: {
        labels: [
          'Facebook',
          'Whatsapp',
          'SMS'
        ],
        datasets: [{
          data: [30, 25, 45],
          backgroundColor: [
            '#97d9f6',
            '#03aeef',
            '#0e08e9',
          ],
          borderColor: "rgba(255, 255, 255, 0.1)",
        }],
      },
      options: {
        title: {
          fontSize: '16',
          display: true,
          text: 'Brasil',
          position: 'top',
        },
        legend: {
          labels: {
            padding: 18,
            usePointStyle: true,
          },
          position: 'left',
        },
        plugins: {
          datalabels: {
            formatter: (value, ctx) => {
              let sum = 0;
              let dataArr = ctx.chart.data.datasets[0].data;
              dataArr.map(data => {
                sum += data;
              });
              let percentage = parseInt((value * 100 / sum));
              return percentage > 0 ? percentage + "%" : "";
            },
            color: '#fff',
          }
        }
      },
    });

    let globalMostUsedCtx = document.getElementById('globalMostUsedChannels').getContext('2d');
    let globalMostUsedChannels = new Chart(globalMostUsedCtx, {
      type: 'doughnut',
      data: {
        labels: [
          'Facebook',
          'Whatsapp',
          'SMS'
        ],
        datasets: [{
          data: [30, 25, 45],
          backgroundColor: [
            '#97d9f6',
            '#03aeef',
            '#0e08e9',
          ],
          borderColor: "rgba(255, 255, 255, 0.1)",
        }],
      },
      options: {
        title: {
          fontSize: '16',
          display: true,
          text: 'Global',
          position: 'top',
        },
        legend: {
          labels: {
            padding: 18,
            usePointStyle: true,
          },
          position: 'left',
        },
        plugins: {
          datalabels: {
            formatter: (value, ctx) => {
              let sum = 0;
              let dataArr = ctx.chart.data.datasets[0].data;
              dataArr.map(data => {
                sum += data;
              });
              let percentage = parseInt((value * 100 / sum));
              return percentage > 0 ? percentage + "%" : "";
            },
            color: '#fff',
          }
        }
      },
    });

    let pieCtx = document.getElementById('pieChart').getContext('2d');
    let pieChart = new Chart(pieCtx, {
      type: 'pie',
      data: {
        labels: [
          'Other UNCTs',
          'Brasil',
        ],
        datasets: [{
          data: [75, 25],
          backgroundColor: [
            '#03aeef',
            '#0054e2',
          ],
          borderColor: "rgba(255, 255, 255, 0.1)",
        }],
      },
      options: {
        aspectRatio: 1.5,
        legend: {
          labels: {
            padding: 18,
            usePointStyle: true,
          },
          position: 'top',
        },
        plugins: {
          datalabels: {
            formatter: (value, ctx) => {
              let sum = 0;
              let dataArr = ctx.chart.data.datasets[0].data;
              dataArr.map(data => {
                sum += data;
              });
              let percentage = parseInt((value * 100 / sum));
              return percentage > 0 ? percentage + "%" : "";
            },
            color: '#fff',
          }
        }
      },
    });

    let contactsCtx = document.getElementById('contactsChart').getContext('2d');
    let contactsChart = new Chart(contactsCtx, {
      type: 'line',
      data: {
        labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
        datasets: [{
          label: 'Global Average',
          borderColor: '#00adf3',
          backgroundColor: '#00adf3',
          data: [15, 20, 30, 35, 39, 42, 56],
        }, {
          label: 'Brasil',
          borderColor: '#0400a4',
          backgroundColor: '#0400a4',
          data: [9, 12, 20, 22, 14, 12, 19],
        }]
      },
      options: {
        legend: {
          labels: {
            padding: 18,
            usePointStyle: true,
          },
          position: 'top',
        },
        scales: {
          xAxes: [{
            gridLines: {
              color: "rgba(0, 0, 0, 0)",
            }
          }],
          yAxes: [{
            stacked: true,
          }]
        },
        plugins: {
          datalabels: {
            display: false,
          }
        }
      }
    });
  </script>

{% endblock %}
