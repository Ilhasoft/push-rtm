{% extends "base.html" %}
{% load i18n static sass_tags %}

{% block nav_item %}page-surveys{% endblock %}

{% block css_extra %}
  <link rel="stylesheet" href="{% static 'plugins/checkbox/checkbox.min.css' %}">
  <link rel="stylesheet" href="{% sass_src 'plugins/tooltip/tooltip.scss' %}">
  <link rel="stylesheet" href="{% sass_src 'css/surveys/survey_results.scss' %}"/>
{% endblock %}

{% block content %}
  <section class="section top-p-0">
    <nav class="breadcrumb" aria-label="breadcrumbs">
      <ul>
        {% if request.user.is_superuser %}
        <li><a href="{% url 'surveys.poll_list' %}">{% trans 'Global Surveys'%}</a></li>
        {% else %}
        <li><a href="{% url 'surveys.poll_list' %}">{% trans 'Surveys'%}</a></li>
        {% endif %}
        <li class="is-active"><a href="#" aria-current="page">{% trans 'Survey Results'%}</a></li>
      </ul>
    </nav>
  </section>
  <section class="section">
    <h1 class="title">{% trans 'Survey Results'%}</h1>
  </section>
  <section class="section">
    <div class="columns is-mobile">
      <div class="column is-one-third-mobile is-one-quarter">
        <aside class="survey-filters">
          {% if request.user.is_superuser %}
            <div class="border-bottom p-30">
              <h3 class="bottom-m-10">
                <img class="right-m-5" src="{% static 'svg/unct.svg' %}" alt="">
                <span>UNCTs</span>
              </h3>
              <div class="control has-icons-left">
                <form>
                  <input class="input is-medium search" name="query" placeholder="{% trans 'Search'%}" value="{{ query }}">
                  <span class="icon is-left">
                  <i class="material-icons">search</i>
                </span>
                </form>
              </div>
            </div>
          {% endif %}
          <div class="survey-filters-content p-30">
            <h3 class="bottom-m-10">
              <img class="right-m-5" src="{% static 'svg/sdg.svg' %}" alt="">
              <span>SDG</span>
            </h3>

            {% for sdg in SDGS %}
              <div class="sdg-checkbox">
                <input class="is-checkradio" type="checkbox" id="sdg{{sdg.0}}" name="sdg{{sdg.0}}">
                <label for="sdg{{sdg.0}}" title="{{ sdg.1 }}">{{ sdg.1 }}</label>
              </div>
            {% endfor %}

          </div>
        </aside>
      </div>
      <div class="column">
        <div class="box is-paddingless">
          <nav class="level is-paddingless border-bottom is-mobile">
            <div class="level-item border-right">
              <span class="title right-m-10 left-m-10">{{ survey.questions_quantity }}</span>
              <span>{% trans 'Questions'%}</span>
              <span class="tooltip top left-m-10">
              <i class="material-icons info-icon">info</i>
              <span class="tooltip-content">{% trans 'The amount of questions in this survey'%}</span>
            </span>
            </div>
<!--          <div class="level-item border-right border-left">-->
<!--            <div class="dropdown is-right">-->
<!--              <div class="dropdown-trigger">-->
<!--                <a class="is-inline-flex" aria-haspopup="true" aria-controls="dropdown-menu">-->
<!--                  <img class="globe-icon" src="{% static 'svg/earth-globe.svg' %}" alt="">-->
<!--                  <p class="title right-m-10 left-m-10">12</p>-->
<!--                  <p class="has-text-grey-dark">Countries</p>-->
<!--                  <i class="material-icons arrow-down-icon">keyboard_arrow_down</i>-->
<!--                  <span class="tooltip top left-m-10">-->
<!--                    <i class="material-icons info-icon">info</i>-->
<!--                    <span class="tooltip-content">Countries participating in this global survey</span>-->
<!--                  </span>-->
<!--                </a>-->
<!--              </div>-->
<!--              <div class="dropdown-menu" id="dropdown-menu" role="menu">-->
<!--                <div class="dropdown-content">-->
<!--                  <a class="dropdown-item">Brasil</a>-->
<!--                  <a class="dropdown-item">USA</a>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
            <div class="level-item">
              <i class="material-icons export-icon right-m-5">save_alt</i>
              <span>Export</span>
              <span class="tooltip top left-m-10">
              <i class="material-icons info-icon">info</i>
              <span class="tooltip-content">{% trans 'Export results on .csv format'%}</span>
            </span>
            </div>
          </nav>
          <div class="p-30 bottom-p-10">
            <div class="bottom-m-40">{{ survey.start_date }}</div>
            <div class="columns bottom-m-20">
              <div class="column is-2 has-text-right">{% trans 'Title:'%}</div>
              <div class="column"><strong>{{ survey.name }}</strong></div>
            </div>
            <div class="columns bottom-m-20">
              <div class="column is-2 has-text-right">{% trans 'Description:'%}</div>
              <div class="column">{{ survey.description }}</div>
            </div>
            <div class="columns bottom-m-10">
              <div class="column is-2 has-text-right">{% trans 'Linked SDGs:'%}</div>
              <div class="column">
                {% for sdg in survey.sdgs %}
                  <span class="tag sdg-{{ sdg.0 }} is-medium right-m-5 bottom-m-5">{{ sdg.0 }} {{ sdg.1 }}</span>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
        <div class="box -is-paddingless">
<!--          todo: adicionar repetição das perguntas -->
          <div class="survey-item border-bottom">
            <div>
              <div class="survey-question-number">{{ question.number }}</div>
            </div>
            <div>
              <span class="survey-question">{{ question.title }}</span>
              <div class="top-m-20">
                <span class="right-m-30">{% trans 'Answered:'%} {{ question.answered }}</span>
                <span>{% trans 'Skipped:'%} {{ question.skipped }}</span>
              </div>
              <div class="top-m-30">
<!--            todo: adicionar repetição para sdgs -->
<!--            <span class="tag sdg-{{sdg.number}} is-medium right-m-5 bottom-m-5">{{ sdg.number }} {{ sdg.name }}</span>-->
              </div>
            </div>
<!--            <div class="accordion-btn"></div>-->
<!--            <div class="question-details border-top top-m-40 top-p-30">-->
<!--              <div class="columns">-->
<!--                <div class="column is-half">-->
<!--                  <div id="localDonutChart"></div>-->
<!--                </div>-->
<!--                {% if request.user.is_superuser %}-->
<!--                <div class="column">-->
<!--                  <div id="globalDonutChart"></div>-->
<!--                </div>-->
<!--                {% endif %}-->
<!--              </div>-->
<!--            </div>-->
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block js_extra %}
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <script>
    // mocked charts
    let localDonutOptions = {
      title: { text: 'Brasil', align: 'left' },
      chart: { type: 'donut', stacked: true, toolbar: { show: false }},
      legend: { position: 'top', horizontalAlign: 'center', fontSize: '16px', onItemClick: { toggleDataSeries: true }, itemMargin: { horizontal: 10, vertical: 10 }},
      colors: ['#03aeef', '#0400a4'],
      series: [50, 50],
      labels: ['Yes', 'No'],
      plotOptions: { pie: { size: 100 }},
      dataLabels: { enabled: true, formatter: function (val) { return val + "%" }, style: { fontSize: '16px'}},
      tooltip: { enabled: false },
    };

    let globalDonutOptions = {
      title: { text: 'Global', align: 'left' },
      chart: { type: 'donut', stacked: true, toolbar: { show: false }},
      legend: { position: 'top', horizontalAlign: 'center', fontSize: '16px', onItemClick: { toggleDataSeries: true }, itemMargin: { horizontal: 10, vertical: 10 }},
      colors: ['#03aeef', '#0400a4'],
      series: [25, 75],
      labels: ['Yes', 'No'],
      plotOptions: { pie: { size: 100 }},
      dataLabels: { enabled: true, formatter: function (val) { return val + "%" }, style: { fontSize: '16px'}},
      tooltip: { enabled: false },
    };

    let localDonutChart = new ApexCharts(
      document.querySelector("#localDonutChart"),
      localDonutOptions
    );

    let globalDonutChart = new ApexCharts(
      document.querySelector("#globalDonutChart"),
      globalDonutOptions
    );

    localDonutChart.render();
    globalDonutChart.render();
  </script>

  <script>
    let acc = document.getElementsByClassName("accordion-btn");
    let i;

    for (i = 0; i < acc.length; i++) {
      acc[i].addEventListener("click", function() {

        this.classList.toggle("active");
        let panel = this.nextElementSibling;
        if (panel.style.display === "block") {
          panel.style.display = "none";
        } else {
          panel.style.display = "block";
        }
      });
    }
  </script>
{% endblock %}
