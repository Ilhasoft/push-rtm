- extends "public_base_v2.html"

- load compress thumbnail humanize ureport i18n

- block content
  .bg-grid.border-t.border-b
    .max-w-page.mx-auto.p-home(class="md:flex")
      .flex-1.flex-center-y
        .text-5xl.font-bold
          -trans "Opinions"
        .text-xl.max-w-lg
          {{ org|config:"opinions_description"|default:""}}

      .flex-center-y(class="{% if is_rtl_org %}md:pr-8{% else %}md:pl-8{% endif %}")
        .block.mt-4(style="width:325px" class="rtl:text-left ltr:text-right")
          .inline-block.bg-black.text-white.text-lg.px-4.py-2.rounded.w-full
            .flex.bg-black.border-b.border-white.w-full
              .flex-1
                %input.bg-black.search-box(type="text" data-results-id="poll-search-results" placeholder="SEARCH" size=14)
              .flex-none
                %a.search-close.cursor-pointer
                  %i.fa.fa-caret-down

        .relative
          .absolute.bg-white.search-results.h-64.border(id="poll-search-results" style="z-index:100000;width:325px;" class="rtl:right-0 ltr:left-0")
            .no-results.p-4.italic.hidden
              -trans "No results found"

            - for category in categories
              - if category.polls.all
                .block.py-1.bg-white.search-category
                  %a.font-bold.px-2.block(href="#")
                    %i.fa.fa-caret-right.closed(style="padding-top:2px" class="rtl:float-right ltr:float-left {% if is_rtl_org %}fa-caret-left{% else %}fa-caret-right{% endif %}")
                    %i.fa.fa-caret-down.hidden.open(style="padding-top:4px" class="rtl:float-right ltr:float-left")
                    .(class="rtl:pr-3 ltr:pl-3")
                      {{ category.name }}
                  .category-results
                    - for poll in category.polls.all
                      %a.block.px-2.py-1.searchable(class="hover:bg-gray-200" href="{% url 'v2.public.opinion_read' poll.pk %}" data-search-value="{{ poll.title|addslashes }} {{ poll.poll_date|date:\"F\" }} {{ poll.poll_date|date:\"Y\" }}")
                        .(class="rtl:mr-2 ltr:ml-2")
                          {{ poll.title }}
                          .inline.text-xs.font-bold
                            {{ poll.poll_date|date:"F" }} {{ poll.poll_date|date:"Y" }}

  .max-w-page.mx-auto
    .bg-white(class="md:flex")
      .flex-1.my-home(class="rtl:border-l ltr:border-r")
        .px-home
          .bg-dark2.inline-block.px-4.py-2.uppercase.leading-none.font-bold.text-sm.text-white
            {{ latest_poll.category.name }}

          .font-bold.leading-tight(class="{% if latest_poll.title|length < 50 %}text-4xl{% else %}text-3xl{% endif %}")
            {{ latest_poll.title }}

          .block
            {{ latest_poll.poll_date|date:"F jS, Y" }}

          .font-light.mt-4
            .inline-block.border-black(class="rtl:pl-8 rtl:border-l ltr:pr-8 ltr:border-r")
              .text-5xl.leading-none
                {{ latest_poll.responded_runs|intcomma }}
              .text-xs.font-bold
                -trans "RESPONSES"

            .inline-block(class="rtl:pr-8 ltr:pl-8")
              .text-5xl.leading-none
                {{ latest_poll.response_percentage }}
              .text-xs.font-bold
                -trans "RESPONSE RATE"

          .mt-4.flex
            .flex-none(class="rtl:ml-8 ltr:mr-8")
              .text-center.inline-block(class="rtl:pl-4 ltr:pr-4")
                %img(src="{{ STATIC_URL }}img/gender-male.png" width="40")
                .font-bold.text-xl.leading-none.mt-2
                  {{gender_stats.male.percentage|default:"0"}}%
                .text-sm.leading-none
                  {{gender_stats.male.count|default:"0"|intcomma}}

              .text-center.inline-block.px-4.border-black(class="rtl:border-r ltr:border-l")
                %img(src="{{ STATIC_URL }}img/gender-female.png" width="40")
                .font-bold.text-xl.leading-none.mt-2
                  {{gender_stats.female.percentage|default:"0"}}%
                .text-sm.leading-none
                  {{gender_stats.female.count|default:"0"|intcomma}}

              - if org|config:"has_extra_gender"
                .text-center.inline-block.px-4.border-black(class="rtl:border-r ltr:border-l")
                  %img(src="{{ STATIC_URL }}img/gender-other.png" width="40")
                  .font-bold.text-xl.leading-none.mt-2
                    {{gender_stats.other.percentage|default:"0"}}%
                  .text-sm.leading-none
                    {{gender_stats.other.count|default:"0"|intcomma}}

            .flex-1.inline-block(style="min-width:220px;max-width:350px")
              .relative.w-full(style="height:105px")
                {{ age_stats|json_script:"age_stats" }}
                #age-bars.w-full.h-full.absolute.age-chart(data-bar-color='{{ org|config:"primary_color"}}' data-label-color="black" data-stats="age_stats")

      .flex-1.text-black
        .py-home.text-center(class="rtl:pr-6 ltr:pl-6 {% if is_rtl_org %}pl-home{% else %}pr-home{% endif %}")
          .text-sm.font-bold.mb-2
            -trans "TOTAL RESPONSES"
          #poll-map.h-full.w-full.map.block(data-map-url="/pollquestion/{{ top_question.id }}/results/" data-district-zoom="{% if district_zoom %}true{% else %}false{% endif %}" data-ward-zoom="{% if ward_zoom %}true{% else %}false{% endif %}" style="min-height:300px;min-width:300px;")
          #map-info.relative.h-full.w-full.my-4.flex.justify-center


    - for question in latest_poll.get_questions
      .block(class="md:flex {% cycle '' 'md:flex-row-reverse' %}" data-aos="fade" style="min-height:30rem;" id="question-block-{{question.id}}")
        .flex-1(class="{% cycle 'bg-dark1 text-white' 'bg-light1 text-black' 'bg-dark2 text-white' 'bg-dark3 text-black' as bg %}")
          .p-home
            .flex(class="{% cycle '' 'md:flex-row-reverse' as reverse %}")
              .flex-none.bg-circle.bg-black.text-white.font-bold
                {{ forloop.counter }}
              .flex-1.flex-center-y
                .h-1.border-t(class="{% if is_rtl_org %}{% cycle 'mr-4' 'ml-4' as margin %}{% else %}{% cycle 'ml-4' 'mr-4' as margin %}{% endif %} {% cycle 'border-white' 'border-black' 'border-white' 'border-white' as border %}")

            .mt-8
              .font-alt.font-bold.leading-tight.italic(class="{% if question.title|length < 50 %}text-3xl{% else %}text-2xl{% endif %}")
                {{ question.title }}

              .font-alt.mt-4
                {% blocktrans with responded=question.get_responded|intcomma polled=question.get_polled|intcomma %}{{ responded }} responded out of {{ polled }} polled{% endblocktrans %}

        .flex-1.bg-white.text-black.hover-parent
          .mx-home.py-home.hover-parent(class="md:border-t")
            .block.justify-between.flex.flex-wrap.hover-parent
              - if not question.is_open_ended
                .text-xs.flex-none.mb-4
                  %a.pill-white.selected.segment-pill(href='#' data-question="{{question.id}}" data-segment="all" data-page="opinions" class="{% if is_rtl_org %}pill-last{% else %}pill-first{% endif %}")>
                    -trans "ALL"
                  %a.pill.pill-white.segment-pill(href='#' data-question="{{question.id}}" data-segment="age" data-page="opinions")>
                    -trans "AGE"
                  %a.pill-white.segment-pill(class="{% if not show_maps %}pill-last{% else %}pill{% endif %}" href='#' data-question="{{question.id}}" data-segment="gender" data-page="opinions")>
                    -trans "GENDER"
                  -if show_maps
                    %a.pill-white.segment-pill.relative.state-pill(href='#' data-question="{{question.id}}" data-segment="state" data-page="opinions" class="{% if is_rtl_org %}pill-first{% else %}pill-last{% endif %}")>
                       -trans "STATE"
                      %i.fa.fa-caret-down
                      .state-dropdown.absolute.z-50(id="states-{{question.id}}" style="margin-left:-1px" data-html2canvas-ignore=true)
                        .border.border-gray-400.bg-white.h-64(style="overflow-y:scroll;margin-top:.5rem;margin-left:-1rem;" class="rtl:text-right ltr:text-left" )
                          .pt-1.text-black
                            - for state in states
                              .py-1.state-segment(data-state='{{state.id}}' data-click-handler="" data-question="{{question.id}}" class="hover:bg-gray-200 {% if forloop.counter0 < 3 %}selected{% endif %} rtl:pr-2 rtl:pl-4 ltr:pl-2 ltr:pr-4" data-page="opinions")
                                .checkbox(class="rtl:float-right ltr:float-left")
                                  %i.fa.fa-check
                                .ml-4.whitespace-no-wrap
                                  {{ state.name }}

              - else
                .block

              .share.flex-none.mb-4.flex-center-y.hover-show(class="rtl:float-left ltr:float-right")
                .block
                  %a.cursor-pointer.bg-circle-xs.border.border-black.facebook-share(data-url="{% org_host_link %}{% url 'v2.public.opinion_read' latest_poll.pk %}#question-id-{{question.id}}")
                    %i.fa.fa-facebook
                  %a.bg-circle-xs.border.border-black(href="https://twitter.com/intent/tweet?url={% org_host_link %}{% url 'v2.public.opinion_read' latest_poll.pk %}#question-id-{{question.id}}")
                    %i.fa.fa-twitter
                  %a.bg-circle-xs.border.border-black(href="https://api.whatsapp.com/send?text={% org_host_link %}{% url 'v2.public.opinion_read' latest_poll.pk %}#question-id-{{question.id}}")
                    %i.fa.fa-whatsapp
                  %a.bg-circle-xs.border.border-black(href="mailto:?subject=Check out {{ poll.title|urlencode:\"\" }} results&amp;body=Check out the results for U-Report poll on {% org_host_link %}{% url 'v2.public.opinion_read' latest_poll.pk %}#question-id-{{question.id}}")
                    %i.fa.fa-envelope
                  %a.cursor-pointer.bg-circle-xs.border.border-black.screenshot-share(data-screen-id="question-block-{{question.id}}")
                    %i.fa.fa-file-image-o


            .relative.w-full(style="min-height:24rem;")
              .w-full.h-full.absolute.poll-chart.block(id="chart-{{ question.id }}" data-question="{{ question.id }}" data-segment="all")

