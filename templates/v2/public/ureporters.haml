- extends "public_base_v2.html"

-load compress ureport dashblocks thumbnail i18n humanize

- block content
  .bg-grid.border-t.border-b
    .max-w-page.mx-auto.p-home(class="md:flex")
      .flex-1.flex-center-y
        .text-5xl.font-bold
          -trans "Engagement"

      .flex-1.flex-center-y
        .text-xl.text-right(class="md:pl-12")
          {{ org|config:"engagement_description"|default:""}}

  .max-w-page.mx-auto
    .bg-black(class="md:flex")
      .flex-1.p-home
        .font-alt.text-light1.italic.mb-4.font-bold.mt-6
          -trans "OVERALL STATISTICS"

        .text-white.font-light.mt-12
          .inline-block.pr-8.border-r.border-white
            .text-5xl.leading-none
              {{org.get_reporters_count|intcomma}}
            .text-xs.font-bold
              -trans "U-REPORTERS"
              .inline.text-light1
                +{{org.get_signup_rate|floatformat}}%
                -trans "THIS YEAR"

          .inline-block.pl-8
            .text-5xl.leading-none
              {{average_response_rate|floatformat}} %
            .text-xs.font-bold
              -trans "AVG RESPONSE RATE"

        .mt-4.flex.mb-8(class="md:mt-12 md:mb-0")
          .flex-none.mr-8
            .text-white.text-center.inline-block.pr-4.border-r.border-white
              %img(src="{{ STATIC_URL }}img/gender-male-w.png" width="40")
              .font-bold.text-xl.leading-none.mt-2
                {{gender_stats.male_percentage}}
              .text-light1.text-sm.leading-none
                {{gender_stats.male_count|intcomma}}

            .text-white.text-center.inline-block.px-4
              %img(src="{{ STATIC_URL }}img/gender-female-w.png" width="40")
              .font-bold.text-xl.leading-none.mt-2
                {{gender_stats.female_percentage}}
              .text-light1.text-sm.leading-none
                {{gender_stats.female_count|intcomma}}
            - if org|config:"has_extra_gender"
              .text-white.text-center.inline-block.px-4.border-l.border-white
                %img(src="{{ STATIC_URL }}img/gender-other-w.png" width="40")
                .font-bold.text-xl.leading-none.mt-2
                  {{gender_stats.other_percentage}}
                .text-light1.text-sm.leading-none
                  {{gender_stats.other_count|intcomma}}

          .flex-1.inline-block(style="min-width:220px;max-width:350px")
            .relative.w-full(style="height:105px")
              {{ age_stats|json_script:"age_stats" }}
              #age-bars.w-full.h-full.absolute.age-chart(data-bar-color='{{ org|config:"light1_color"|default:"#FFD100"}}' data-label-color="white" data-stats="age_stats")

      .flex-1.text-white.bg-dark-blue.vertical-angle
        .pl-6.pr-home.py-home.text-center
          .text-sm.font-bold.mb-2
            -trans "U-REPORTERS BY REGION"
          #ureporter-map.h-full.w-full.map.block(data-map-url="/v2/contact_field_results/" data-district-zoom="'{{ district_zoom|lower }}' === 'true'" data-ward-zoom="'{{ ward_zoom|lower }}' === 'true'" style="min-height:300px;min-width:300px;")
          #map-info.relative.h-full.w-full.mt-2.flex.justify-center
  
  .border-t.border-b.bg-dark-gray.sticky.top-0.z-50
    .max-w-page.mx-auto.px-home.py-4.border-gray-800(class="md:flex md:justify-between")
      .text-white.font-bold.flex-center-y
        -trans "FILTER RESULTS"

      .flex-center-y
        .text-white.text-xs.flex
          - for time_filter in data_time_filters
            .cursor-pointer.border-white.pill-black.tab-button-time-filter(class="{% if forloop.first %}pill-first{% elif forloop.last %}selected pill-last{% else %}pill{% endif %}" data-time-filter="{{time_filter.time_filter_number}}")
              {{time_filter.label}}

  .max-w-page.mx-auto.bg-dark-blue.p-home.text-white.border-b.border-white
    - for time_filter in data_time_filters
      .engagemment-content.hover-parent(id="tab-content-block-{{time_filter.time_filter_number}}" class="{% if not forloop.last %}hidden{% endif %}")
        - for metric in data_metrics
          .engagement-graph-block.hover-parent.block.mt-16.p-2.bg-dark-blue(class="md:flex" style="min-height:30rem; max-height:45rem;" data-aos="fade" id="graph-block-{{metric.slug}}-{{time_filter.time_filter_number}}")
            .hover-parent(class="md:w-2/5")
              .bg-light1.h-1.w-16.mb-4
              .text-3xl.mb-4.font-bold
                {{ metric.title }}

              .text-xs.flex.mb-6.text-black.random-pill(data-page="engagement")
                - for segment in data_segments
                  - if forloop.first
                    %a.pill-first.pill-dark-blue-inverted.segment-pill(href='#' data-page="engagement" data-metric-slug="{{metric.slug}}" data-segment-type="{{segment.segment_type}}" data-time-filter="{{time_filter.time_filter_number}}")>
                      {{segment.label|upper}}
                  - elif forloop.last
                    %a.pill-last.pill-dark-blue-inverted.segment-pill.state-pill.relative.whitespace-no-wrap(href="#" data-page="engagement" data-metric-slug="{{metric.slug}}" data-segment-type="{{segment.segment_type}}" data-time-filter="{{time_filter.time_filter_number}}" data-graph-id="engagement-graph-{{metric.slug}}-{{segment.segment_type}}-{{time_filter.time_filter_number}}" id="location-pill-{{metric.slug}}-{{segment.segment_type}}-{{time_filter.time_filter_number}}")>
                      {{segment.label|upper}}
                      %i.fa.fa-caret-down
                      .state-dropdown.absolute.z-50(id="location-pill-{{metric.slug}}-{{segment.segment_type}}-{{time_filter.time_filter_number}}" style="margin-left:-1px" data-html2canvas-ignore=true)
                        .border.border-gray-400.text-left.bg-white.h-64(style="overflow-y:scroll;margin-top:.5rem;margin-left:-1rem;")
                          .pt-1.text-black
                            - for state in states
                              .pl-2.pr-4.py-1.state-segment(data-state='{{state.id}}' class="hover:bg-gray-200 {% if forloop.counter0 < 3 %}selected{% endif %}" data-page="engagement"  data-metric-slug="{{metric.slug}}" data-segment-type="{{segment.segment_type}}" data-time-filter="{{time_filter.time_filter_number}}")>
                                .checkbox.float-left
                                  %i.fa.fa-check
                                .ml-4.whitespace-no-wrap
                                  {{ state.name }}

                  - else
                    %a.pill.pill-dark-blue-inverted.segment-pill(href="#"  data-page="engagement" data-metric-slug="{{metric.slug}}" data-segment-type="{{segment.segment_type}}" data-time-filter="{{time_filter.time_filter_number}}")>
                      {{segment.label|upper}}

              .share.flex-none.mb-4.flex-center-y.hover-show
                .block
                  %a.cursor-pointer.bg-circle-xs.border.border-white.text-white.facebook-share(data-url="{% org_host_link %}{% url 'v2.public.engagement' %}")
                    %i.fa.fa-facebook
                  %a.bg-circle-xs.border.border-white.text-white(href="https://twitter.com/intent/tweet?url={% org_host_link %}{% url 'v2.public.engagement' %}")
                    %i.fa.fa-twitter
                  %a.bg-circle-xs.border.border-white.text-white(href="https://api.whatsapp.com/send?text={% org_host_link %}{% url 'v2.public.engagement' %}")
                    %i.fa.fa-whatsapp
                  %a.bg-circle-xs.border.border-white.text-white(href="mailto:?subject=Check out {{ poll.title|urlencode:\"\" }} results&amp;body=Check out the results for U-Report poll on {% org_host_link %}{% url 'v2.public.engagement'  %}" uk-icon="icon: mail; ratio: 1.5")
                    %i.fa.fa-envelope
                  %a.cursor-pointer.bg-circle-xs.border.border-white.text-white.screenshot-share(data-screen-id="graph-block-{{metric.slug}}-{{time_filter.time_filter_number}}")
                    %i.fa.fa-file-image-o

            .block(class="md:w-3/5")
              .engagement-graph-tabs(id="graph-tabs-{{metric.slug}}-{{time_filter.time_filter_number}}")
                - for segment in data_segments
                  .engagement-graph.hidden(id="graph-tabs-{{metric.slug}}-{{segment.segment_type}}-{{time_filter.time_filter_number}}")
                    .engagement-chart.has-graph(id="engagement-graph-{{metric.slug}}-{{segment.segment_type}}-{{time_filter.time_filter_number}}" data-metric-slug="{{metric.slug}}" data-segment-type="{{segment.segment_type}}" data-time-filter="{{time_filter.time_filter_number}}")


